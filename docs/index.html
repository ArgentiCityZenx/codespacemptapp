<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CodespaceMPT | Dashboard</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        /* General styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            background-color: #000;
            margin: 0;
            padding: 0;
        }

        #logout {
            background-color: white;
            border-radius: 1px;
            font-family: 'Roboto', sans-serif;
        }
        #user-info {
            display: none;
        }
        #logout, #save-bio {
            background-color: white;
            border-radius: 1px;
            font-family: 'Roboto', sans-serif;
        }
        #bio-container {
            display: none;
        }
        #profile-img {
            height: 30px;
            width: 30px;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 10px;
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        #login-google {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-decoration: none;
            width: 185px;
            height: 50px;
        }

        #login-google span {
            display: flex;
            align-items: center;
            height: 100%;
        }

        #login-google:hover {
            background-color: #357ae8;
        }

        .top {
    background-color: #00000000;
    padding: 10px; /* Adjusted padding for smaller screens */
    display: flex;
    align-items: center;
    flex-wrap: wrap; /* Allow items to wrap on smaller screens */
}

.logo {
    width: 50px; /* Adjusted size for smaller screens */
    margin-right: 10px; /* Adjusted margin */
}

.CodespaceMPT {
    margin: 0;
    font-size: 30px; /* Adjusted font size */
    flex: 1; /* Take remaining space */
}


        .left-side-menu {
    width: 30%;
    height: auto; /* Adjusted height */
    margin-top: 30px;
    overflow: auto;
    padding: 20px;
    float: none; /* Remove float for responsiveness */
    background-color: #292929;
    border-radius: 17px;
}


        .repotitle {
            margin: 0;
            font-size: 22.5px;
            color: #fff;
        }

        #folders {
            margin-top: 20px;
            padding: 0;
            list-style-type: none;
        }

        .div {
   width: 30%; /* Adjusted for responsiveness */
    margin: 20px auto;
    background-color: #333;
    border: 2px solid #555;
    border-radius: 5px;
    padding: 15px;
}

.div h1 {
    font-size: 20px; /* Adjusted font size */
    margin: 0 0 10px;
}

#repoName {
    width: 100%;
    padding: 8px; /* Adjusted padding */
    margin-bottom: 10px;
    border: 1px solid #555;
    border-radius: 3px;
    color: #fff;
    background-color: #444;
    box-sizing: border-box;
    font-size: 16px; /* Adjusted font size */
}

.submit {
display: block;
    background-color: #393939;
    color: #fff;
    width: 100%;
    padding: 12px; /* Adjusted padding */
    font-size: 18px; /* Adjusted font size */
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


        .submit:hover {
            background-color: #292929;
        }

        a {
            color: rgb(20, 238, 0);
            transition: all 0.3s;
        }

        a:hover {
            color: green;
        }

        /* User profile styles */
        #userProfile {
            display: flex;
            align-items: center;
            margin-left: auto;
        }

        #userProfile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        #logout {
            background-color: white;
            border-radius: 1px;
            font-family: 'Roboto', sans-serif;
        }
        #user-info {
            display: none;
        }
        #profile-img {
            height: 30px;
            width: 30px;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 10px;
        }
        /* Google sign-in button styles */
        #login-google {
            float: right;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-decoration: none;
            width: 185px;
            height: 50px;
        
        }

        #login-google span {
            display: flex;
            align-items: center;
            height: 100%;
        }

        #login-google:hover {
            background-color: #357ae8;
        }
        #login-github {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            color: rgb(22, 21, 21);
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-decoration: none;
            width: 185px;
            height: 50px;
        }
        #login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(255, 255, 255);
            color: rgb(22, 21, 21);
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-decoration: none;
            width: 185px;
            height: 50px;
        }
        #login-btn:hover {
            background-color: rgb(210, 210, 210);
        }
        #login-google span, #login-github span, #login-btn span {
            display: flex;
            align-items: center;
            height: 100%;
        }

        #login-github:hover {
            background-color: rgb(236, 236, 236);
        }
        #logout {
            float: right;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            text-decoration: none;
            width: 185px;
            height: 50px;
        
        }
        
        #searchBar {
    width: 100%;
    padding: 8px;
    margin: 10px 0;
    border: 1px solid #555;
    border-radius: 3px;
    color: #fff;
    background-color: #444;
    box-sizing: border-box;
    font-size: 16px;
}

.container {
    width: 90%;
    max-width: 500px;
    background-color: white;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}
form {
    display: flex;
    flex-direction: column;
}
input[type="text"], input[type="email"], input[type="password"], input[type="file"], button {
    margin-bottom: 15px;
    padding: 10px;
    font-size: 16px;
}

.profile-pic {
    display: block;
    margin: 10px auto;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    object-fit: cover;
}
.hidden {
    display: none;
}
    </style>
</head>
<body>
    <div class="top">
        <img id="profile-img" class="logo" alt="Logo" src="/favicon.png"><!-- Google sign-in button -->
        <h1 class="CodespaceMPT">Dashboard</h1>

        <style>
            *,
            *::before,
            *::after {
              box-sizing: border-box;
            }
            .forms-section {
              display: none;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              height: 100vh;
            }
            .section-title {
              font-size: 32px;
              letter-spacing: 1px;
              color: #fff;
            }
            .forms {
              display: flex;
              align-items: flex-start;
              margin-top: 30px;
            }
            .form-wrapper {
              animation: hideLayer .3s ease-out forwards;
            }
            .form-wrapper.is-active {
              animation: showLayer .3s ease-in forwards;
            }
            @keyframes showLayer {
              50% {
                z-index: 1;
              }
              100% {
                z-index: 1;
              }
            }
            @keyframes hideLayer {
              0% {
                z-index: 1;
              }
              49.999% {
                z-index: 1;
              }
            }
            .switcher {
              position: relative;
              cursor: pointer;
              display: block;
              margin-right: auto;
              margin-left: auto;
              padding: 0;
              text-transform: uppercase;
              font-family: inherit;
              font-size: 16px;
              letter-spacing: .5px;
              color: #999;
              background-color: transparent;
              border: none;
              outline: none;
              transform: translateX(0);
              transition: all .3s ease-out;
            }
            .form-wrapper.is-active .switcher-login {
              color: #fff;
              transform: translateX(90px);
            }
            .form-wrapper.is-active .switcher-signup {
              color: #fff;
              transform: translateX(-90px);
            }
            .underline {
              position: absolute;
              bottom: -5px;
              left: 0;
              overflow: hidden;
              pointer-events: none;
              width: 100%;
              height: 2px;
            }
            .underline::before {
              content: '';
              position: absolute;
              top: 0;
              left: inherit;
              display: block;
              width: inherit;
              height: inherit;
              background-color: currentColor;
              transition: transform .2s ease-out;
            }
            .switcher-login .underline::before {
              transform: translateX(101%);
            }
            .switcher-signup .underline::before {
              transform: translateX(-101%);
            }
            .form-wrapper.is-active .underline::before {
              transform: translateX(0);
            }
            .form {
              overflow: hidden;
              min-width: 260px;
              margin-top: 50px;
              padding: 30px 25px;
              border-radius: 5px;
              transform-origin: top;
            }
            .form-login {
              animation: hideLogin .3s ease-out forwards;
            }
            .form-wrapper.is-active .form-login {
              animation: showLogin .3s ease-in forwards;
            }
            @keyframes showLogin {
              0% {
                background: #d7e7f1;
                transform: translate(40%, 10px);
              }
              50% {
                transform: translate(0, 0);
              }
              100% {
                background-color: #fff;
                transform: translate(35%, -20px);
              }
            }
            @keyframes hideLogin {
              0% {
                background-color: #fff;
                transform: translate(35%, -20px);
              }
              50% {
                transform: translate(0, 0);
              }
              100% {
                background: #d7e7f1;
                transform: translate(40%, 10px);
              }
            }
            .form-signup {
              animation: hideSignup .3s ease-out forwards;
            }
            .form-wrapper.is-active .form-signup {
              animation: showSignup .3s ease-in forwards;
            }
            @keyframes showSignup {
              0% {
                background: #d7e7f1;
                transform: translate(-40%, 10px) scaleY(.8);
              }
              50% {
                transform: translate(0, 0) scaleY(.8);
              }
              100% {
                background-color: #fff;
                transform: translate(-35%, -20px) scaleY(1);
              }
            }
            @keyframes hideSignup {
              0% {
                background-color: #fff;
                transform: translate(-35%, -20px) scaleY(1);
              }
              50% {
                transform: translate(0, 0) scaleY(.8);
              }
              100% {
                background: #d7e7f1;
                transform: translate(-40%, 10px) scaleY(.8);
              }
            }
            .form fieldset {
              position: relative;
              opacity: 0;
              margin: 0;
              padding: 0;
              border: 0;
              transition: all .3s ease-out;
            }
            .form-login fieldset {
              transform: translateX(-50%);
            }
            .form-signup fieldset {
              transform: translateX(50%);
            }
            .form-wrapper.is-active fieldset {
              opacity: 1;
              transform: translateX(0);
              transition: opacity .4s ease-in, transform .35s ease-in;
            }
            .form legend {
              position: absolute;
              overflow: hidden;
              width: 1px;
              height: 1px;
              clip: rect(0 0 0 0);
            }
            .input-block {
              margin-bottom: 20px;
            }
            .input-block label {
              font-size: 14px;
              color: #a1b4b4;
            }
            .input-block input {
              display: block;
              width: 100%;
              margin-top: 8px;
              padding-right: 15px;
              padding-left: 15px;
              font-size: 16px;
              line-height: 40px;
              color: #3b4465;
              background: #eef9fe;
              border: 1px solid #cddbef;
              border-radius: 2px;
            }
            .form [type='submit'] {
              opacity: 0;
              display: block;
              min-width: 120px;
              margin: 30px auto 10px;
              font-size: 18px;
              line-height: 40px;
              border-radius: 25px;
              border: none;
              transition: all .3s ease-out;
            }
            .form-wrapper.is-active .form [type='submit'] {
              opacity: 1;
              transform: translateX(0);
              transition: all .4s ease-in;
            }
            .btn-login {
              color: #fbfdff;
              background: #a7e245;
              transform: translateX(-30%);
            }
            .btn-signup {
              color: #a7e245;
              background: #fbfdff;
              box-shadow: inset 0 0 0 2px #a7e245;
              transform: translateX(30%);
            }
                  </style>
                  <section class="forms-section" id="forms-section">
                    <h1 class="section-title">Login or Signup</h1>
                    <div class="forms">
                      <div class="form-wrapper is-active">
                        <button type="button" class="switcher switcher-login">
                          Login
                          <span class="underline"></span>
                        </button>
                        <form class="form form-login" id="login-form">
                          <fieldset>
                            <legend>Please, enter your email and password for login.</legend>
                            <div class="input-block">
                              <label for="login-email">E-mail</label>
                              <input id="login-email" type="email" name="email" required>
                            </div>
                            <div class="input-block">
                              <label for="login-password">Password</label>
                              <input id="login-password" type="password" name="password" required>
                            </div>
                          </fieldset>
                          <button type="submit" class="btn-login">Login</button>
                        </form>
                      </div>
                      <div class="form-wrapper">
                        <button type="button" class="switcher switcher-signup">
                          Sign Up
                          <span class="underline"></span>
                        </button>
                        <form class="form form-signup" id="signup-form">
                          <fieldset>
                            <legend>Please, enter your email, password and password confirmation for sign up.</legend>
                            <div class="input-block">
                              <label for="signup-username">Username</label>
                              <input id="signup-username" type="text" name="username" required>
                            </div>
                            <div class="input-block">
                              <label for="signup-email">E-mail</label>
                              <input id="signup-email" type="email" name="email" required>
                            </div>
                            <div class="input-block">
                              <label for="signup-password">Password</label>
                              <input id="signup-password" type="password" name="password" required>
                            </div>
                          </fieldset>
                          <button type="submit" class="btn-signup">Sign Up</button>
                        </form>
                      </div>
                    </div>
                  </section>
                
                  <script>
                        const switchers = [...document.querySelectorAll('.switcher')];
        
        switchers.forEach(item => {
          item.addEventListener('click', function() {
            switchers.forEach(item => item.parentElement.classList.remove('is-active'));
            this.parentElement.classList.add('is-active');
          });
        });
        
                    document.addEventListener('DOMContentLoaded', function() {
                      const formsSection = document.getElementById('forms-section');
                      const loginForm = document.getElementById('login-form');
                      const signupForm = document.getElementById('signup-form');
                      const logoutBtn = document.getElementById('logout');
                      const createDatabase = document.getElementById('createDatabase');
                      const loginGoogle = document.getElementById('login-google');
                      const loginGithub = document.getElementById('login-github');
                      const loginBtn = document.getElementById('login-btn');
                
                      document.addEventListener('DOMContentLoaded', () => {
    var storedUser = JSON.parse(localStorage.getItem('user'));
    if (storedUser) {
        updateUI(storedUser);
        
    }
});

                      // Verifica el estado de autenticación
                      const isLoggedIn = localStorage.getItem('isLoggedIn');
                
                      if (isLoggedIn) {
                        // Si está logueado, oculta los formularios y muestra los botones de logout y create database
                        formsSection.style.display = 'none';
                        logoutBtn.style.display = 'inline-block';
                        createDatabase.style.display = 'block';
                        loginGoogle.style.display = 'none';
                        loginGithub.style.display = 'none';
                        loginBtn.style.display = 'none';
                      } else {
                        // Si no está logueado, muestra los formularios de login y signup
                        
                        logoutBtn.style.display = 'none';
                        createDatabase.style.display = 'none';
                        loginGoogle.style.display = 'flex';
                        loginGithub.style.display = 'flex';
                        loginBtn.style.display = 'flex';
                      }
                
                      // Maneja el inicio de sesión
                      loginForm.addEventListener('submit', function(event) {
                        event.preventDefault();
                        const email = loginForm.email.value;
                        const password = loginForm.password.value;
                
                        // Obtener usuarios del localStorage
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const user = users.find(user => user.email === email && user.password === password);
                
                        if (user) {
                          localStorage.setItem('isLoggedIn', 'true');
                          formsSection.style.display = 'none';
                          logoutBtn.style.display = 'inline-block';
                          createDatabase.style.display = 'block';
                          loginGoogle.style.display = 'none';
                          loginGithub.style.display = 'none';
                          loginBtn.style.display = 'none';
                          alert('Login successful!');
                        } else {
                          alert('Invalid email or password.');
                        }
                      });
                
                      // Maneja el registro
                      signupForm.addEventListener('submit', function(event) {
                        event.preventDefault();
                        const username = signupForm.username.value;
                        const email = signupForm.email.value;
                        const password = signupForm.password.value;
                
                        // Obtener usuarios del localStorage
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const userExists = users.some(user => user.email === email);
                
                        if (userExists) {
                          alert('User already exists.');
                        } else {
                          users.push({ username, email, password });
                          localStorage.setItem('users', JSON.stringify(users));
                          localStorage.setItem('isLoggedIn', 'true');
                          formsSection.style.display = 'none';
                          logoutBtn.style.display = 'inline-block';
                          createDatabase.style.display = 'block';
                          loginGoogle.style.display = 'none';
                          loginGithub.style.display = 'none';
                          loginBtn.style.display = 'none';
                          document.getElementById("greeting").innerText = username + "'s Repositories"
                          alert('Sign up successful!');
                        }
                      });
                
                      // Maneja el logout
                      logoutBtn.addEventListener('click', function() {
                        localStorage.removeItem('isLoggedIn');
                        formsSection.style.display = 'none';
                        logoutBtn.style.display = 'none';
                        createDatabase.style.display = 'none';
                        loginGoogle.style.display = 'flex';
                        loginGithub.style.display = 'flex';
                        loginBtn.style.display = 'flex';
                        document.getElementById("greeting").innerText = "CodespaceMPT Repositories"
                        alert('Logged out successfully.');
                      });
                      loginBtn.addEventListener('click', function() {
                        formsSection.style.display = 'flex';
                      });
                      });
                  </script>

        <div id="settings">
            <div id="delete">
                <label for="deleteToggle">Delete Repositories</label>
            <input type="checkbox" id="deleteToggle">
            </div>
            <!-- Login and Logout buttons -->
            <button id="login-google">
                <img src="https://google.com/favicon.ico" alt="" width="30" height="30">
                <pre> </pre><span>Sign In with Google</span>
            </button>
            <button id="login-github">
                <img src="https://github.com/favicon.ico" alt="" width="30" height="30">
                <pre> </pre><span>Sign In with GitHub</span>
            </button>
            <button id="login-btn">
                <img src="https://www.globalnet.cl/wp-content/uploads/2019/01/correo.jpg" alt="" width="30">
                <pre> </pre><span>Sign In or Sign Up</span></button>
            <button id="logout" style="display:none;">
                Logout
            </button>
            <div id="userProfile">
                <!-- User profile picture and greeting will be dynamically added here -->
            </div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBV-ORfPHX4ceoitgqxHAcGpY-mILltv-4",
    authDomain: "codespacempt-e73bc.firebaseapp.com",
    projectId: "codespacempt-e73bc",
    storageBucket: "codespacempt-e73bc.appspot.com",
    messagingSenderId: "696364541552",
    appId: "1:696364541552:web:3c9e760749ea15ce1cf6b5"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function handleCredentialLinking(user, credential) {
    user.linkWithCredential(credential).then(function() {
        console.log('Account linked successfully');
    }).catch(function(error) {
        console.log('Error linking account:', error);
    });
}

function signInWithProvider(provider) {
    auth.signInWithPopup(provider).then(function(result) {
        var user = result.user;

        if (user) {
            console.log('User:', user);  // Debugging line to check user object
            console.log('Additional User Info:', result.additionalUserInfo);  // Check additional user info

            // Check if displayName is null and log the provider-specific data
            if (!user.displayName && result.additionalUserInfo && result.additionalUserInfo.username) {
                console.log('GitHub Username:', result.additionalUserInfo.username);
                user.updateProfile({
                    displayName: result.additionalUserInfo.username
                }).then(() => {
                    document.getElementById("greeting").innerText = user.displayName + " Repositories";
                });
            } else {
                document.getElementById("greeting").innerText = (user.displayName || "User") + " Repositories";
            }

            // Save user info to localStorage
            localStorage.setItem('user', JSON.stringify({
                displayName: user.displayName,
                photoURL: user.photoURL
            }));

            updateUI(user);
        } else {
            console.log('No user is signed in.');
        }
    }).catch(function(error) {
        if (error.code === 'auth/account-exists-with-different-credential') {
            var pendingCred = error.credential;
            var email = error.email;
            auth.fetchSignInMethodsForEmail(email).then(function(methods) {
                if (methods[0] === 'google.com') {
                    var provider = new firebase.auth.GoogleAuthProvider();
                    auth.signInWithPopup(provider).then(function(result) {
                        handleCredentialLinking(result.user, pendingCred);
                    });
                } else if (methods[0] === 'github.com') {
                    var provider = new firebase.auth.GithubAuthProvider();
                    auth.signInWithPopup(provider).then(function(result) {
                        handleCredentialLinking(result.user, pendingCred);
                    });
                }
            });
        } else {
            console.log(error.message);
        }
    });
}

document.getElementById("login-google").addEventListener("click", function() {
    var provider = new firebase.auth.GoogleAuthProvider();
    signInWithProvider(provider);
});

document.getElementById("login-github").addEventListener("click", function() {
    var provider = new firebase.auth.GithubAuthProvider();
    signInWithProvider(provider);
});

document.getElementById("logout").addEventListener("click", function() {
    auth.signOut().then(function() {
        document.getElementById("profile-img").src = "/favicon.png";
        document.getElementById("greeting").innerText = "CodespaceMPT Repositories";
        document.getElementById("logout").style.display = "none";
        document.getElementById("login-google").style.display = "block";
        document.getElementById("login-github").style.display = "block";
        document.getElementById("login-btn").style.display = "block";
        document.getElementById("createDatabase").style.display = "none"

        // Clear user info from localStorage
        localStorage.removeItem('user');
    }).catch(function(error) {
        console.log(error.message);
    });
});

// Update UI based on user info
function updateUI(user) {
    var profilePic = document.getElementById('profile-img');
    var greeting = document.getElementById('greeting');
    var settings = document.getElementById('settings');

    if (user) {
        // Replace logo with user's profile picture
        profilePic.src = user.photoURL;

        // Change "Dashboard" header to "user's dashboard"
        greeting.textContent = `${user.displayName}'s Repositories`;

        // Show the logout button and hide the login buttons
        document.getElementById("logout").style.display = "block";
        document.getElementById("login-google").style.display = "none";
        document.getElementById("login-github").style.display = "none";
        document.getElementById("login-btn").style.display = "none";
        document.getElementById("createDatabase").style.display = "block";
        
    } else {
        // Reset logo to the default image
        profilePic.src = '/favicon.png';

        // Change "user's dashboard" header back to "Dashboard"
        greeting.textContent = 'Repositories';

        // Show the settings element after user is logged out
        settings.style.display = 'block';

        // Show the login buttons and hide the logout button
        document.getElementById("logout").style.display = "none";
        document.getElementById("login-google").style.display = "block";
        document.getElementById("login-github").style.display = "block";
        document.getElementById("login-btn").style.display = "block";
        document.getElementById("createDatabase").style.display = "none";
        
    }
}

// Check if the user is already logged in on page load
document.addEventListener('DOMContentLoaded', () => {
    var storedUser = JSON.parse(localStorage.getItem('user'));
    if (storedUser) {
        updateUI(storedUser);
        
    }
});
</script>



            


            

        </div>
        <div id="userProfile">
            <!-- User profile picture and greeting will be dynamically added here -->
        </div>
        
    </div>

    <!-- Left-side menu (folders) -->
<div class="left-side-menu">
    <h1 class="repotitle" id="greeting">CodespaceMPT Repositories</h1>
    <input type="text" id="searchBar" placeholder="Search Repositories">
    <hr>
    <ul id="folders"></ul>
</div>

    <form class="div" id="repoForm" action="edit/index.html" method="GET">
        <h1>Make a New Repository</h1>
        <p>Write your code and save the repository as a ZIP file. You can also upload files in the code editor.</p>
        <label for="repoName">Enter Repository Name:</label>
        <input type="text" id="repoName" name="repoName" placeholder="Enter a name for your repository">
        <button type="submit" class="submit">Create Repository</button>
    </form>
    

    <div class="div">
        <h1>APIs</h1>
        <p>These are our APIs. They show you your repositories or user in a JSON file. If you are not logged in or have no repositories, then the JSON files will come out empty and nothing will show up. We are planning to add more things to the APIs.</p>
        <button onclick="redirect()" class="submit">Redirect to APIs</button>
        <script>
            function redirect() {
                window.location.href = 'api/'
            }
        </script>
        
    </div>


<script>
    // Function to filter the repository list based on search input
    function filterRepos() {
        var input = document.getElementById('searchBar');
        var filter = input.value.toLowerCase();
        var ul = document.getElementById('folders');
        var li = ul.getElementsByTagName('li');
        
        for (var i = 0; i < li.length; i++) {
            var a = li[i].getElementsByTagName('a')[0];
            if (a.innerHTML.toLowerCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }

    // Add event listener to the search bar
    document.getElementById("searchBar").addEventListener('keyup', filterRepos);
</script>

    <script>
        // Function to add a repository to the list with a hidden delete button
function addRepoToList(repoName, description) {
    var ul = document.getElementById('folders');
    var li = document.createElement('li');
    var a = document.createElement('a');
    a.textContent = `${repoName} | ${description}`;
    a.href = '/edit?repoName=' + encodeURIComponent(repoName);
    a.target = "_blank"; // Open in a new tab
    li.appendChild(a);

    // Create a delete button for each repository and hide it
    var deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete';
    deleteButton.style.display = 'none';
    deleteButton.style.backgroundColor = 'blue';
    deleteButton.style.border = '3px solid blue';
    deleteButton.style.marginLeft = '5px';
    deleteButton.style.color = 'white';

    deleteButton.onclick = function() {
        if (confirm('Are you sure you want to delete this repository?')) {
            li.remove();
            deleteRepo(repoName);
        }
    };
    li.appendChild(deleteButton);

    ul.appendChild(li);
}

// Function to save a new repository to localStorage
function saveRepo(repoName, description) {
    var repos = JSON.parse(localStorage.getItem('repos')) || [];
    repos.push({ name: repoName, description: description });
    localStorage.setItem('repos', JSON.stringify(repos));
}

// Function to delete a repository from localStorage
function deleteRepo(repoName) {
    var repos = JSON.parse(localStorage.getItem('repos')) || [];
    var index = repos.findIndex(repo => repo.name === repoName);
    if (index !== -1) {
        repos.splice(index, 1);
        localStorage.setItem('repos', JSON.stringify(repos));
    }
}

// Function to create a new repository and add it to the list
function createRepo() {
    var repoName = document.getElementById('repoName').value;
    var description = prompt('Enter description for the repository:');
    
    // Set default description if empty
    if (!description) {
        description = "No description provided";
    }

    if (repoName) {
        addRepoToList(repoName, description);
        saveRepo(repoName, description);
        document.getElementById('repoName').value = ''; // Clear input field
    } else {
        // Handle case where repoName is empty (if needed)
        console.log("Repository name cannot be empty");
    }
}


// Function to load repositories from localStorage
function loadRepos() {
    var repos = JSON.parse(localStorage.getItem('repos')) || [];
    repos.forEach(repo => addRepoToList(repo.name, repo.description));
}

// Load repositories when the page loads
window.addEventListener('DOMContentLoaded', loadRepos);

// Function to toggle the visibility of delete buttons
function toggleDeleteButtons() {
    var deleteButtons = document.querySelectorAll('#folders li button');
    deleteButtons.forEach(function(button) {
        button.style.display = button.style.display === 'none' ? 'inline' : 'none';
    });
}

// Add event listener to the delete toggle checkbox
document.getElementById('deleteToggle').addEventListener('change', toggleDeleteButtons);

// Add event listener to the form to handle repository creation
document.getElementById('repoForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form from submitting
    createRepo();
});


    </script>
<div class="div" id="createDatabase">
    <h1>Create Databases</h1>
    <p>If you are authenticated, you can write your own databases! Databases are info structured that you can access electronically. For grant you all security, you define a password first time you access for type your databases, and you need it for access to edit it next time.</p>
    <button class="submit" id="createDatabaseButton">Create a Database</button>
    <div id="databaseList"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const auth = firebase.auth();

    // Manejo de la autenticación
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('createDatabase').style.display = 'block';
            document.getElementById('createDatabaseButton').addEventListener('click', () => {
                createDatabase(user);
            });
            displayDatabases(user);
        } else {
            // Redirigir al login si no está autenticado
            document.getElementById('createDatabase').style.display = 'none';
            document.getElementById('databaseList').innerHTML = '';
        }
    });

    // Crear un nuevo database y guardarlo en localStorage
    function createDatabase(user) {
        const dbName = prompt('Enter database name:');
        if (dbName) {
            const dbPassword = prompt('Set a password for this database:');
            const databases = JSON.parse(localStorage.getItem(user.uid)) || [];
            const newDatabase = { name: dbName, content: '', password: dbPassword };
            databases.push(newDatabase);
            localStorage.setItem(user.uid, JSON.stringify(databases));
            displayDatabases(user);
        }
    }

    // Mostrar la lista de databases
    function displayDatabases(user) {
        const databases = JSON.parse(localStorage.getItem(user.uid)) || [];
        const databaseList = document.getElementById('databaseList');
        databaseList.innerHTML = `<h3>${user.displayName || "User"} Databases</h3>`;
        databases.forEach((db, index) => {
            const dbElement = document.createElement('div');
            dbElement.innerHTML = `
                <p>${db.name}</p>
                <button onclick="editDatabase('${db.name}')">Edit</button>
                <button onclick="deleteDatabase(${index}, '${user.uid}')">Delete</button>
            `;
            databaseList.appendChild(dbElement);
        });
    }
});

// Función para redirigir al editor de texto
function editDatabase(dbName) {
    const user = firebase.auth().currentUser;
    const databases = JSON.parse(localStorage.getItem(user.uid)) || [];
    const database = databases.find(db => db.name === dbName);

    if (!database.password) {
        // Primera vez que se accede, definir contraseña
        const newPassword = prompt('Set a password for this database:');
        if (newPassword) {
            database.password = newPassword;
            localStorage.setItem(user.uid, JSON.stringify(databases));
            alert('Password set successfully. Redirecting to the editor.');
            window.location.href = `./edit-database?databaseName=${encodeURIComponent(dbName)}`;
        } else {
            alert('Password is required.');
        }
    } else {
        // Solicitar contraseña existente
        const enteredPassword = prompt('Enter the password for this database:');
        if (database.password === enteredPassword) {
            window.location.href = `/edit-database?databaseName=${encodeURIComponent(dbName)}`;
        } else {
            alert('Incorrect password. Redirecting to home page.');
            window.location.href = 'index.html';
        }
    }
}

// Función para eliminar una base de datos
function deleteDatabase(index, userId) {
    const databases = JSON.parse(localStorage.getItem(userId)) || [];
    databases.splice(index, 1);
    localStorage.setItem(userId, JSON.stringify(databases));
    alert('Database deleted successfully. Refresh for view the changes');
    const user = firebase.auth().currentUser;
    displayDatabases(user);
}
</script>
        <script>
            window.onload = function() {
                window.scrollTo(0, 0);
            };
        </script>
</body>
</html>

